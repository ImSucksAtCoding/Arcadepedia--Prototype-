<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arcadepedia | View Topic "Arcadepedia"</title>
    <!--Import fonts for icons-->
    <script src="https://kit.fontawesome.com/d535fdea96.js" crossorigin="anonymous"></script>
    <!--Css file-->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <link rel="stylesheet" href="./Viewtopic(+posts).css">
</head>
<body>
    <header class="header">
        <div class="left-section">
            <div class="menu">
                <label class="hamburger-menu" for="check">
                    <input type="checkbox" id="check" class="hamburger-menu-trigger">
                </label>
            </div>
            <a href="Homepage.html">
            <div class="logo">
                <span>
                    arcade<span class="pedia">pedia</span>
                </span>
            </div>
           </a> 
        </div>

        <div class="right-section">
            <a href="#">
                <div class="search-button" role="button">
                    <i class="fa-solid fa-magnifying-glass"></i>
                </div> 
            </a>   
            <a href="login.html">
                <div class="login-button" role="button">
                    Login
                </div>
            </a>
            <a href="register.html">
                <div class="register-button" role="button">
                    <i class="fa-regular fa-circle-user" id="profile"></i>
                    Register
                </div>
            </a>
            <div class="bg-toggle-button" role="button">
                <i class="fa-solid fa-moon"></i>
            </div>
        </div>
    </header>

    <div class="main">
        <div class="sidebar">
            <nav role="navigation">
                <ul class="links">
                    <li><a href="Homepage.html"><div class="items"><i class="fa fa-house"></i><span>Home</span></div></a></li>
                    <li id="sub-menu"><div class="items"><i class="fa-regular fa-compass"></i><span>Explore</span><i class="fa-solid fa-chevron-down" id="expand"></i></div>
                        <ul class="sublink">
                            <li><a href="#">General</a></li>
                            <li><a href="#">All entries</a></li>
                        </ul>   
                    </li>
                    <li id="sub-menu"><div class="items"><i class="fa-regular fa-comments"></i><span>Forums</span><i class="fa-solid fa-chevron-down" id="expand"></i></div>
                        <ul class="sublink">
                            <li><a href="#">Discussions</a></li>
                            <li><a href="#">Users</a></li>
                        </ul>   
                    </li>
                    <li id="sub-menu"><div class="items"><i class="fa-regular fa-circle-question"></i><span>About</span><i class="fa-solid fa-chevron-down expand" id="expand"></i></div>
                        <ul class="sublink">
                            <li><a href="#">About us</a></li>
                            <li><a href="#">Rules</a></li>
                            <li><a href="#">Disclaimer</a></li>
                        </ul>                    
                    </li>
                </ul>
            </nav>
        </div>

        <div class="content container-fluid">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="/">Home</a></li>
                    <li class="breadcrumb-item"><a href="#">Forum</a></li>
                    <li class="breadcrumb-item"><a href="/forum/topics">Topics</a></li>
                    <li class="breadcrumb-item"><a href="#"><%= topic._id %></a></li>
                    <li class="breadcrumb-item active" aria-current="page">Posts</li>
                </ol>
            </nav>
            
            <div class="row">
                <div class="topicDescription col-xl-10 col-lg-10 col-md-10 mx-auto">
                    <h1>Arcadepedia</h1>
                    <p>Important information regarding Arcadepedia will be posted here.</p>
                </div>
            </div>

            <div class="row">
                <div class="feed col-xl-6 col-lg-6 col-md-10 mx-auto">
                    <div class="makePost">
                        <div class="userClick">
                            <img class="profilePic" src="./assets/Viewpost/placeholder-pic.png" alt="profilePic" width="40px" height="40px">
                            <span>What's on your mind?</span>
                        </div>
                    </div>
                    <div class="rules-embed">
                        <button class="rulesBtn">Rules</button>
                        <div class="rules-embed-show invisible">
                            <h2 class="text-center">Rules</h2>
                            <p>1. Be nice and treat people with respect. Keep discussions civil and be open-minded about differing opinions.</p>
                            <p>2. Do not ask for or share links to pirated material.</p>
                            <p>3. Spamming, trolling, or impersonating other users will lead to your account being banned.</p>        
                        </div>
                    </div>
                    <hr>
                    <form action="#" method="get" id="searchFilter">
                        <select id="filterPosts" name="filterPosts">
                            <option value="oldest" selected>Oldest</option>
                            <option value="latest">Latest</option>
                        </select>
                        <input type="text" name="searchTitle" id="searchTitle" placeholder="Search posts' title">
                        <input type="text" name="searchContent" id="searchContent" placeholder="Search posts' content">
                        <button type="submit">Search</button>
                    </form>
                    <hr>
                    <div class="postSection">
                        <div class="post" id="1">
                            <div class="infoRow justify-content-between">
                                <div class="userInfo">
                                    <span><img class="profilePic" src="./assets/Viewpost/placeholder-pic.png" alt="profilePic" width="40px" height="40px"></span>
                                    <span class="username">Minh Khoi</span>
                                    <span class="timestampSeperator">•</span>
                                    <span class="timestamp">May 15th, 2099</span>
                                </div>
                                <div class="options-container">
                                    <span class="option"><i class="fa-solid fa-ellipsis"></i></span>
                                    <div class="buttons-container invisible">
                                        <form action="#" method="get" class="userAction">
                                            <button type="submit"><i class="fa-solid fa-trash"></i>Delete</button>
                                        </form>
                                        <form action="#" method="get" class="userAction">
                                            <button type="submit"><i class="fa-solid fa-pen"></i>Edit</button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <a href="#" class="noUnderlineLink"><h2>Title</h2></a>
                            </div>
                            <div class="row">
                                <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
                            </div>
                            <div class="row">
                                <span>
                                    <span class="reaction">
                                        <span class="like-post-button">&#x25B2;</span>
                                        0
                                        <span class="dislike-post-button">&#x25BC;</span>    
                                    </span>
                                    <span class="reply">
                                        <span class="comment-outline">
                                            <i class="fa-regular fa-message"></i>
                                        </span>
                                        <span class="numberOfComments">
                                            123
                                        </span>
                                    </span>
                                </span>
                            </div>
                        </div>
                        <hr>
                        <div class="post" id="2">
                            <div class="infoRow justify-content-between">
                                <div class="userInfo">
                                    <span><img class="profilePic" src="./assets/Viewpost/placeholder-pic.png" alt="profilePic" width="40px" height="40px"></span>
                                    <span class="username">Minh Khoi</span>
                                    <span class="timestampSeperator">•</span>
                                    <span class="timestamp">May 15th, 2099</span>
                                </div>
                                <div class="options-container">
                                    <span class="option"><i class="fa-solid fa-ellipsis"></i></span>
                                    <div class="buttons-container invisible">
                                        <form action="#" method="get" class="userAction">
                                            <button type="submit"><i class="fa-solid fa-trash"></i>Delete</button>
                                        </form>
                                        <form action="#" method="get" class="userAction">
                                            <button type="submit"><i class="fa-solid fa-pen"></i>Edit</button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <a href="#" class="noUnderlineLink"><h2>Title</h2></a>
                            </div>
                            <div class="row">
                                <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.</p>
                            </div>
                            <div class="row">
                                <span>
                                    <span class="reaction">
                                        <span class="like-post-button">&#x25B2;</span>
                                        0
                                        <span class="dislike-post-button">&#x25BC;</span>    
                                    </span>
                                    <span class="reply">
                                        <span class="comment-outline">
                                            <i class="fa-regular fa-message"></i>
                                        </span>
                                        <span class="numberOfComments">
                                            123
                                        </span>
                                    </span>
                                </span>
                            </div>    
                        </div>
                        <hr>
                        <div class="post" id="3">
                            <div class="infoRow justify-content-between">
                                <div class="userInfo">
                                    <span><img class="profilePic" src="./assets/Viewpost/placeholder-pic.png" alt="profilePic" width="40px" height="40px"></span>
                                    <span class="username">Minh Khoi</span>
                                    <span class="timestampSeperator">•</span>
                                    <span class="timestamp">May 15th, 2099</span>
                                </div>
                                <div class="options-container">
                                    <span class="option"><i class="fa-solid fa-ellipsis"></i></span>
                                    <div class="buttons-container invisible">
                                        <form action="#" method="get" class="userAction">
                                            <button type="submit"><i class="fa-solid fa-trash"></i>Delete</button>
                                        </form>
                                        <form action="#" method="get" class="userAction">
                                            <button type="submit"><i class="fa-solid fa-pen"></i>Edit</button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <a href="#" class="noUnderlineLink"><h2>Title</h2></a>
                            </div>
                            <div class="row">
                                <p>Body</p>
                            </div>
                            <div class="row">
                                <span>
                                    <span class="reaction">
                                        <span class="like-post-button">&#x25B2;</span>
                                        0
                                        <span class="dislike-post-button">&#x25BC;</span>    
                                    </span>
                                    <span class="reply">
                                        <span class="comment-outline">
                                            <i class="fa-regular fa-message"></i>
                                        </span>
                                        <span class="numberOfComments">
                                            123
                                        </span>
                                    </span>
                                </span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="rules col-xl-3 col-lg-3">
                    <h2 class="text-center">Rules</h2>
                    <p>1. Be nice and treat people with respect. Keep discussions civil and be open-minded about differing opinions.</p>
                    <p>2. Do not ask for or share links to pirated material.</p>
                    <p>3. Spamming, trolling, or impersonating other users will lead to your account being banned.</p>
                </div>
            </div>
        </div>
    </div>

    <footer class="site-footer">
        <div class="container">
            <div class="row">
                <div id="position">
                    <div class="logo">
                        <span style="color: white;">
                            arcade<span class="pedia">pedia</span>
                    </span>
            </div>
                </div>
            </div>
        </div>
        <div class="container">
          <div class="row">
            <div class="col-sm-12 col-md-4">
              <h6>Contact us</h6>
             <form action="#" class="contact-form">
                                <div class="form-group">
                                  <input type="text" class="form-control" placeholder="Name">
                                </div>
                                <div class="form-group">
                                  <input type="text" class="form-control" placeholder="Email">
                                </div>
                                <div class="form-group">
                                  <textarea name="" id="" cols="30" rows="3" class="form-control" placeholder="Message"></textarea>
                                </div>
                                <div class="form-group">
                                    <button type="submit" class="form-control submit px-3">Send</button>
                                </div>
                          </form>
            </div>
  
            <div class="col-xs-6 col-md-4">
              <h6>Forum</h6>
              <ul class="footer-links">
                <li><a href="Viewtopics.html">Topics</a></li>
                <li><a href="Viewtopic(+posts).html">Posts</a></li>
                <li><a href="#">Gallery</a></li>
                
              </ul>
            </div>
  
            <div class="col-xs-6 col-md-4">
              <h6>Quick Links</h6>
              <ul class="footer-links">
                <li><a href="Homepage.html">Home</a></li>
                <li><a href="legalAndCompliance.html">Legal & Compliance</a></li>
                <li><a href="Sitemap.html">Sitemap</a></li>
              </ul>
            </div>
          </div>
          <hr>
        </div>
        <div class="container">
          <div class="row">
            <div class="col-md-8 col-sm-6 col-xs-12">
              <p class="copyright-text">Copyright &copy; <script>document.write(new Date().getFullYear());</script>
              </p>
            </div>
  
            <div class="col-md-4 col-sm-6 col-xs-12">
              <ul class="social-icons">
                <li><a class="facebook" href="#"><i class="fa fa-facebook"></i></a></li>
                <li><a class="twitter" href="#"><i class="fa fa-twitter"></i></a></li>
                <li><a class="instagram" href="#"><i class="fa fa-instagram"></i></a></li>
                  
              </ul>
            </div>
          </div>
        </div>
    </footer>
    <script>
        //Variables declaration
        let makePostWidget = document.querySelector(".makePost");
        let i = 0;
        let initialHeight;

        let options = document.querySelectorAll(".option");

        let likePostBtns = document.querySelectorAll(".like-post-button");
        let dislikePostBtns = document.querySelectorAll(".dislike-post-button");
        let likeCommentBtns = document.querySelectorAll(".like-comment-button");
        let dislikeCommentBtns = document.querySelectorAll(".dislike-comment-button");

        let rulesEmbed = document.querySelector('.rules-embed');
        let rules = document.querySelector('.rules');
        let rulesDetails = document.querySelector('.rules-embed-show');

        //For hamburger menu action
        let menuIcon = document.querySelector('.hamburger-menu-trigger')
        let sidebar = document.querySelector('.sidebar')

        makePostWidget.addEventListener("click", (e) => {
            if(i === 0) {
                i++;
                e.currentTarget.classList.add('expanded');

                e.currentTarget.innerHTML = '';

                // Create the form element
                let form = document.createElement('form');
                form.action = "/forum/topics/<%= topicId %>/posts/<%= post._id %>/comment";
                form.method = "get";
                form.className = "formAction";

                // Create the input element
                let input = document.createElement('input');
                input.type = 'text';
                input.name = 'post[title]';
                input.placeholder = "Post title";

                // Create the input element
                let editor = document.createElement('div');
                editor.className = 'editor';

                // Define the buttons and their data-elements
                const buttons = [
                    { element: 'bold', icon: 'fa-bold' },
                    { element: 'italic', icon: 'fa-italic' },
                    { element: 'underline', icon: 'fa-underline' },
                    { element: 'insertUnorderedList', icon: 'fa-list-ul' },
                    { element: 'insertOrderedList', icon: 'fa-list-ol' },
                    { element: 'createLink', icon: 'fa-link' }
                ];

                // Create the buttons and append them to the editor
                buttons.forEach(button => {
                    let btn = document.createElement('button');
                    btn.type = 'button';
                    btn.className = 'edit-btn';
                    btn.dataset.element = button.element;

                    let i = document.createElement('i');
                    i.className = `fa-solid ${button.icon} fa-lg`;

                    btn.appendChild(i);
                    editor.appendChild(btn);
                });

                // Create the textarea element
                let textarea = document.createElement('textarea');
                textarea.name = "post[content]";
                textarea.id = "postContent";
                textarea.placeholder = "Post content";

                // Create the output div element
                let output = document.createElement('div');
                output.className = "output";
                // output.style.wordWrap = "break-word";
                // output.style.whiteSpace = "pre-wrap";

                //Create the submit button
                let submitBtn = document.createElement('button');
                submitBtn.type = 'submit';
                submitBtn.textContent = 'Post';
                submitBtn.className = "submitBtnB";

                //Create the "escape hatch" button, to put the textarea off
                let exitBtn = document.createElement('div')
                exitBtn.className = 'exitBtn'
                exitBtn.textContent = 'Exit'

                //Click event on the 'exit' button to move out the form
                // exitBtn.addEventListener('click', (event) => {
                //     // event.stopPropagation()
                //     makePostWidget.classList.remove('expanded')
                //     makePostWidget.classList.add('makePost')
                //     i = 0
                // })

                // Append the textarea to the form
                form.appendChild(input);
                form.appendChild(editor);
                form.appendChild(textarea);
                form.appendChild(output);
                form.appendChild(submitBtn);

                // Append the form to the e.currentTarget
                e.currentTarget.appendChild(form);
                e.currentTarget.appendChild(exitBtn)

                if (!document.querySelector('#myScript')) {
                    let script = document.createElement('script');
                    script.id = 'myScript';
                    script.src = 'makepost.js';
                    // script.src = '<%= remove this to get the right link for makepost.js %>/js/makepost.js';
                    document.body.appendChild(script);
                }
                /*============================================================================================================*/
                // <div class="makePost">
                //     <form action="/forum/topics/<%= topicId %>/posts/<%= post._id %>/comment" method="get" class="formAction">
                //         <input type="text" name="post[title]" placeholder="Post title"></input>

                //         <div class="editor">
                //             <button type="button" class="edit-btn" data-element="bold"><i class="fa-solid fa-bold fa-lg"></i></button>
                //             <button type="button" class="edit-btn" data-element="italic"><i class="fa-solid fa-italic fa-lg"></i></button>
                //             <button type="button" class="edit-btn" data-element="underline"><i class="fa-solid fa-underline fa-lg"></i></button>
                //             <button type="button" class="edit-btn" data-element="insertUnorderedList"><i class="fa-solid fa-list-ul fa-lg"></i></button>
                //             <button type="button" class="edit-btn" data-element="insertOrderedList"><i class="fa-solid fa-list-ol fa-lg"></i></button>
                //             <button type="button" class="edit-btn" data-element="createLink"><i class="fa-solid fa-link fa-lg"></i></button>
                //         </div>

                //         <textarea name="post[content]" id="postContent" placeholder="Write your comment here.."></textarea>
                //         <div class="output"></div>
                //         <button type="submit" class="submitBtnB">Post</button>
                //     </form>
                // </div>

                // //Added js file that links to makepost.js
                /*============================================================================================================*/
            }

            i++;

            let commentArea = document.querySelector('.makePost textarea');
            let outputDiv = document.querySelector('.makePost div.output');

            if (initialHeight !== commentArea.offsetHeight) {
                initialHeight = commentArea.offsetHeight;
            }

            // Add event listener for the input event
            commentArea.addEventListener('input', (e) => {
                makePostArea(commentArea, output);
            });

            makePostArea(commentArea, outputDiv);
        });

        function makePostArea(dom_elem1, dom_elem2) {
            if(dom_elem1.offsetHeight > 200) {
                dom_elem1.parentElement.parentElement.style.height = (dom_elem1.offsetHeight + dom_elem2.offsetHeight + 250) + "px";
            } else {
                dom_elem1.parentElement.parentElement.style.height = (dom_elem1.offsetHeight + dom_elem2.offsetHeight + 200) + "px";
            }
        }

        const adjustRulesVisibility = (e) => {
            if (window.matchMedia('(max-width: 991px)').matches) {
                // if (rulesEmbed.classList.contains('invisible')) {
                    rulesEmbed.classList.remove('invisible');
                    rules.classList.add('invisible');
                    //Avoiding overflow since the 'rules' class still have display
                    rules.style.display = 'none'
                // }
            } else {
                // if (!rulesEmbed.classList.contains('invisible')) {
                    rulesEmbed.classList.add('invisible');
                    rules.classList.remove('invisible');
                    rules.style.display = 'block' 
                // }
            }
            // Mobile responsive
            if (window.matchMedia('(max-width: 576px)').matches) {
                sidebar.style.display = 'none'
                menuIcon.style.display = 'flex'
            } else {
                menuIcon.style.display = 'none'
                sidebar.style.display = 'flex'
            }
        };

        // Call the function when the page loads
        adjustRulesVisibility();

        // Call the function when the window is resized
        window.addEventListener('resize', adjustRulesVisibility);

        rulesEmbed.addEventListener("click", (e) => {
            rulesDetails.classList.toggle('invisible');
            if(rulesDetails.style.position === 'relative') {
                rulesDetails.style.position = 'absolute';
            } else {
                rulesDetails.style.position = 'relative';
            }
        });

        options.forEach((option) => {
            option.addEventListener("click", (e) => {
                let btnsContainer = option.parentElement.querySelectorAll(".buttons-container");
                btnsContainer.forEach((btn) => {
                    btn.classList.toggle("invisible");
                })
            })
        });

        [...likePostBtns, ...likeCommentBtns].forEach(button => {
            button.addEventListener("click", (e) => {
                if(button.classList.contains("like-post-button")) {
                    button.classList.toggle("likedLike");
                } else {
                    button.classList.toggle("likedLike");
                }
            });
        });

        [...dislikePostBtns, ...dislikeCommentBtns].forEach(button => {
            button.addEventListener("click", (e) => {
                if(button.classList.contains("dislike-post-button")) {
                    button.classList.toggle("dislikedDislike");
                } else {
                    button.classList.toggle("dislikedDislike");
                }
            });
        });

        //Function to display the sidebar in mobile responsive
        menuIcon.addEventListener('click', (e) => {
            if (menuIcon.checked == true) {
                console.log(menuIcon.checked);
                sidebar.style.display = 'flex';
            } else if (menuIcon.checked == false) {
                console.log(menuIcon.checked);
                sidebar.style.display = 'none';
            }
        })
    </script>
</body>
</html>
